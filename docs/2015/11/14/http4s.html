<!DOCTYPE html>
<html lang="ja" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>ScalaのHTTPインターフェース http4s 超入門 | dakatsuka&#39;s blog</title>
<meta name="keywords" content="Scala, http4s">
<meta name="description" content="What&rsquo;s http4s RackやWSGIのScala版といったところ。公式サイトの説明も次のように書いてある。 http4s is a minimal, idiomatic Scala interface for HTTP. http4s is Scala&rsquo;s answer to Ruby&rsquo;s Rack, Python&rsquo;s WSGI, Haskell&rsquo;s WAI, and Java&rsquo;s Servlets. ま">
<meta name="author" content="Dai Akatsuka">
<link rel="canonical" href="https://blog.dakatsuka.jp/2015/11/14/http4s.html">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css" integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://blog.dakatsuka.jp/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.dakatsuka.jp/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.dakatsuka.jp/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.dakatsuka.jp/apple-icon-180x180.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-45923728-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="ScalaのHTTPインターフェース http4s 超入門" />
<meta property="og:description" content="What&rsquo;s http4s RackやWSGIのScala版といったところ。公式サイトの説明も次のように書いてある。 http4s is a minimal, idiomatic Scala interface for HTTP. http4s is Scala&rsquo;s answer to Ruby&rsquo;s Rack, Python&rsquo;s WSGI, Haskell&rsquo;s WAI, and Java&rsquo;s Servlets. ま" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.dakatsuka.jp/2015/11/14/http4s.html" /><meta property="og:image" content="https://blog.dakatsuka.jp/images/card.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2015-11-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2015-11-14T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:image" content="https://blog.dakatsuka.jp/images/card.png"/>

<meta name="twitter:title" content="ScalaのHTTPインターフェース http4s 超入門"/>
<meta name="twitter:description" content="What&rsquo;s http4s RackやWSGIのScala版といったところ。公式サイトの説明も次のように書いてある。 http4s is a minimal, idiomatic Scala interface for HTTP. http4s is Scala&rsquo;s answer to Ruby&rsquo;s Rack, Python&rsquo;s WSGI, Haskell&rsquo;s WAI, and Java&rsquo;s Servlets. ま"/>
<meta name="twitter:site" content="@d_akatsuka"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ScalaのHTTPインターフェース http4s 超入門",
      "item": "https://blog.dakatsuka.jp/2015/11/14/http4s.html"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ScalaのHTTPインターフェース http4s 超入門",
  "name": "ScalaのHTTPインターフェース http4s 超入門",
  "description": "What\u0026rsquo;s http4s RackやWSGIのScala版といったところ。公式サイトの説明も次のように書いてある。 http4s is a minimal, idiomatic Scala interface for HTTP. http4s is Scala\u0026rsquo;s answer to Ruby\u0026rsquo;s Rack, Python\u0026rsquo;s WSGI, Haskell\u0026rsquo;s WAI, and Java\u0026rsquo;s Servlets. ま",
  "keywords": [
    "Scala", "http4s"
  ],
  "articleBody": "What’s http4s RackやWSGIのScala版といったところ。公式サイトの説明も次のように書いてある。\nhttp4s is a minimal, idiomatic Scala interface for HTTP. http4s is Scala’s answer to Ruby’s Rack, Python’s WSGI, Haskell’s WAI, and Java’s Servlets.\nまだまだ開発途中でドキュメントなどはあまり整備されていなくて、まともに使おうと思ったらソースコードを読む必要が出てきそう。次期Scalatraのバックエンドになるとかならないとか噂されているけどはてさて？もしかしたらAkkaやFinagleに押されて流行らずに終わる可能性もある。\nちなみにscalaz-streamが使われている。\nInstall 最小構成で使う場合は http4s-server と http4s-blaze-server だけで良い。\nresolvers += \"Scalaz Bintray Repo\" at \"http://dl.bintray.com/scalaz/releases\" libraryDependencies ++= Seq( \"org.http4s\" %% \"http4s-server\" % \"0.10.1\", \"org.http4s\" %% \"http4s-blaze-server\" % \"0.10.1\" ) Specification http4sの仕様に準拠したアプリケーション（http4sではサービスという）として最低限必要なことは次の通り。\norg.http4s.server.HttpService 型であること 以上！めちゃくちゃシンプルですね。HttpServiceの定義を覗いてみるとこう書いてある。\ntype Service[A, B] = Kleisli[Task, A, B] type HttpService = Service[Request, Response] 実際はHttpServiceを作るための関数が HttpService.apply として用意されているのでこれを使っていく。この関数はRequest型を受け取ってTask[Response]型を返すPartialFunctionを引数に取る。\nobject HttpService { def apply(pf: PartialFunction[Request, Task[Response]], default: HttpService = empty): HttpService } Rackなどを触ったことがある人ならピンと来るはず。\nIntroduction アクセスすると画面にHello WorldとQueryStringを表示する簡単なサービスを作ってみる。\n// src/main/scala/jp/dakatsuka/http4stest/Bootstrap.scala package jp.dakatsuka.http4stest import org.http4s.{Status, Response} import org.http4s.server.HttpService import org.http4s.server.blaze.BlazeBuilder object Bootstrap { val service = HttpService { case req =\u003e Response() .withStatus(Status.Ok) .withBody(s\"Hello World!! ${req.queryString}\") } def main(args: Array[String]): Unit = BlazeBuilder .bindHttp(8080) .mountService(service) .run .awaitShutdown() } sbt runを実行してブラウザで http://localhost:8080/?foo=bar\u0026fizz=buzz にアクセス。次のような文字がブラウザ上に表示されるはず。\nHello World!! foo=bar\u0026fizz=buzz Middleware ミドルウェアも簡単につくれる。ミドルウェアは既存のHttpServiceに組み込んで（合成して）使う。試しにX-HTTP4S-MESSAGEというヘッダーを付与するミドルウェアを作ってみる。\n// src/main/scala/jp/dakatsuka/http4stest/MessageMiddleware.scala package jp.dakatsuka.http4stest import org.http4s.Header import org.http4s.server.HttpService object MessageMiddleware { def apply(service: HttpService, message: String): HttpService = HttpService.lift { req =\u003e service.map { res =\u003e res.putHeaders(Header(\"X-HTTP4S-MESSAGE\", message)) }.apply(req) } } 組み込み方はこう。\ndef main(args: Array[String]): Unit = BlazeBuilder .bindHttp(8080) .mountService(MessageMiddleware(service, \"Hello!!!!!\")) .run .awaitShutdown() ちゃんとヘッダーに追加されていることが分かる。\n$ curl --dump-header - http://localhost:8080 HTTP/1.1 200 OK Content-Length: 14 Content-Type: text/plain; charset=UTF-8 X-HTTP4S-MESSAGE: Hello!!!!! Date: Sat, 14 Nov 2015 13:30:32 GMT Hello World!! http4s-dsl http4s-dslというパッケージを追加すればSinatraのようにDSLを使ってルーティングを定義できる。\nbuild.sbtに依存関係を追加する。\nlibraryDependencies ++= Seq( \"org.http4s\" %% \"http4s-server\" % \"0.10.1\", \"org.http4s\" %% \"http4s-dsl\" % \"0.10.1\", \"org.http4s\" %% \"http4s-blaze-server\" % \"0.10.1\" ) DSLを使うと次のように直感的にルーティングできるようになる。ちょっとしたマイクロサービスを作りたいときにはこれで十分な気がする。\nimport org.http4s._ import org.http4s.dsl._ import org.http4s.server.HttpService import jp.dakatsuka.http4stest.model.User val service = HttpService { case GET -\u003e Root =\u003e Ok(\"Document Root\") case GET -\u003e Root / \"users\" =\u003e Ok(User.all) case GET -\u003e Root / \"users\" / LongVar(id) =\u003e User.find(id) match { case Some(user) =\u003e Ok(user) case _ =\u003e NotFound() } case GET -\u003e Root / \"users\" / screen_name =\u003e User.findOneByScreenName(screen_name) match { case Some(user) =\u003e Ok(user) case _ =\u003e NotFound() } case req @ POST -\u003e Root / \"users\" =\u003e req.decode[UrlForm] { data =\u003e val UserParams = for { email \u003c- data.getFirst(\"email\") screen_name \u003c- data.getFirst(\"screen_name\") } yield UserParams(email, screen_name) ??? } } JSON レスポンスを返したい 厳密にはcase classをOkやNotFoundに渡したらJSON文字列に変換してレスポンスを返して欲しい。になる。\nhttp4sは EntityEncoder[T] を定義しておけばどんな型でもレスポンスとして返せるという仕組みがある（逆のEntityDecoderもある）JSONに関しては http4s-argonaut という公式パッケージが用意されているのでそれを利用するのが良いだろう。Argonautが嫌な人はJson4s用のパッケージも用意されているのでそちらを。\nlibraryDependencies ++= Seq( \"org.http4s\" %% \"http4s-server\" % \"0.10.1\", \"org.http4s\" %% \"http4s-dsl\" % \"0.10.1\", \"org.http4s\" %% \"http4s-blaze-server\" % \"0.10.1\", \"org.http4s\" %% \"http4s-argonaut\" % \"0.10.1\" ) // src/main/scala/jp/dakatsuka/http4stest/model/User.scala package jp.dakatsuka.http4s.model import argonaut.Argonaut._ import argonaut.CodecJson import org.http4s.argonaut._ import org.http4s.EntityEncoder case class User(id: Long, email: String, screen_name: String) object User { implicit val userCodec: CodecJson[User] = casecodec3(User.apply, User.unapply)(\"id\", \"email\", \"screen_name\") implicit val userEntityEncoder: EntityEncoder[User] = jsonEncoderOf[User] implicit val usersEntityEncoder: EntityEncoder[List[User]] = jsonEncoderOf[List[User]] def all(): List[User] = ??? def find(id: Long): Option[User] = ??? def findOneByScreenName(screen_name: String): Option[User] = ??? } まとめ 駆け足でhttp4sを紹介してみたけど、個人的にはかなり使い勝手が良いと思う。Akka, Playframeworkのような重厚感もないし http4s-dsl を使えば簡単にAPIの実装も出来るだろう。お手軽感って大事だと思う。ルーティングやレスポンスを型安全に書けるのもポイントが高い。\n懸念点としては最初にも書いたようにライバルが多くて消えてしまうのでは…ってところ。http4sはServletでも動くので頑張って欲しい。\n",
  "wordCount" : "1641",
  "inLanguage": "ja",
  "datePublished": "2015-11-14T00:00:00Z",
  "dateModified": "2015-11-14T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Dai Akatsuka"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.dakatsuka.jp/2015/11/14/http4s.html"
  },
  "publisher": {
    "@type": "Organization",
    "name": "dakatsuka's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.dakatsuka.jp/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.dakatsuka.jp/" accesskey="h" title="dakatsuka&#39;s blog (Alt + H)">dakatsuka&#39;s blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.dakatsuka.jp/about.html" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://blog.dakatsuka.jp/archives.html" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://blog.dakatsuka.jp/tags.html" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      ScalaのHTTPインターフェース http4s 超入門
    </h1>
    <div class="post-meta"><span title='2015-11-14 00:00:00 +0000 UTC'>2015/11/14</span>&nbsp;·&nbsp;Dai Akatsuka

</div>
  </header> 
  <div class="post-content"><h2 id="whats-http4s">What&rsquo;s http4s<a hidden class="anchor" aria-hidden="true" href="#whats-http4s">#</a></h2>
<p>RackやWSGIのScala版といったところ。<a href="http://http4s.org/">公式サイト</a>の説明も次のように書いてある。</p>
<blockquote>
<p>http4s is a minimal, idiomatic Scala interface for HTTP. http4s is Scala&rsquo;s answer to Ruby&rsquo;s Rack, Python&rsquo;s WSGI, Haskell&rsquo;s WAI, and Java&rsquo;s Servlets.</p>
</blockquote>
<p>まだまだ開発途中でドキュメントなどはあまり整備されていなくて、まともに使おうと思ったらソースコードを読む必要が出てきそう。次期Scalatraのバックエンドになるとかならないとか噂されているけどはてさて？もしかしたらAkkaやFinagleに押されて流行らずに終わる可能性もある。</p>
<p>ちなみにscalaz-streamが使われている。</p>
<h2 id="install">Install<a hidden class="anchor" aria-hidden="true" href="#install">#</a></h2>
<p>最小構成で使う場合は <code>http4s-server</code> と <code>http4s-blaze-server</code> だけで良い。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>resolvers <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;Scalaz Bintray Repo&#34;</span> at <span style="color:#e6db74">&#34;http://dl.bintray.com/scalaz/releases&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>libraryDependencies <span style="color:#f92672">++=</span> <span style="color:#a6e22e">Seq</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;org.http4s&#34;</span> <span style="color:#f92672">%%</span> <span style="color:#e6db74">&#34;http4s-server&#34;</span>       <span style="color:#f92672">%</span> <span style="color:#e6db74">&#34;0.10.1&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;org.http4s&#34;</span> <span style="color:#f92672">%%</span> <span style="color:#e6db74">&#34;http4s-blaze-server&#34;</span> <span style="color:#f92672">%</span> <span style="color:#e6db74">&#34;0.10.1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span></code></pre></div><h2 id="specification">Specification<a hidden class="anchor" aria-hidden="true" href="#specification">#</a></h2>
<p>http4sの仕様に準拠したアプリケーション（http4sではサービスという）として最低限必要なことは次の通り。</p>
<ul>
<li><code>org.http4s.server.HttpService</code> 型であること</li>
</ul>
<p>以上！めちゃくちゃシンプルですね。HttpServiceの定義を覗いてみるとこう書いてある。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Service</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Kleisli</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Task</span>, <span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">HttpService</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Service</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Request</span>, <span style="color:#66d9ef">Response</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>実際はHttpServiceを作るための関数が <code>HttpService.apply</code> として用意されているのでこれを使っていく。この関数は<code>Request</code>型を受け取って<code>Task[Response]</code>型を返す<code>PartialFunction</code>を引数に取る。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">HttpService</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">(</span>pf<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">PartialFunction</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Request</span>, <span style="color:#66d9ef">Task</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Response</span><span style="color:#f92672">]],</span> default<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HttpService</span> <span style="color:#f92672">=</span> empty<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HttpService</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Rackなどを触ったことがある人ならピンと来るはず。</p>
<h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>アクセスすると画面にHello WorldとQueryStringを表示する簡単なサービスを作ってみる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#75715e">// src/main/scala/jp/dakatsuka/http4stest/Bootstrap.scala
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">package</span> jp.dakatsuka.http4stest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.<span style="color:#f92672">{</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Response</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.server.HttpService
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.server.blaze.BlazeBuilder
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Bootstrap</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">val</span> service <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">HttpService</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> req <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Response</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>withStatus<span style="color:#f92672">(</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Ok</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>withBody<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Hello World!! </span><span style="color:#e6db74">${</span>req<span style="color:#f92672">.</span>queryString<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">BlazeBuilder</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>bindHttp<span style="color:#f92672">(</span><span style="color:#ae81ff">8080</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>mountService<span style="color:#f92672">(</span>service<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>run
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>awaitShutdown<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><code>sbt run</code>を実行してブラウザで <code>http://localhost:8080/?foo=bar&amp;fizz=buzz</code> にアクセス。次のような文字がブラウザ上に表示されるはず。</p>
<pre tabindex="0"><code>Hello World!! foo=bar&amp;fizz=buzz
</code></pre><h2 id="middleware">Middleware<a hidden class="anchor" aria-hidden="true" href="#middleware">#</a></h2>
<p>ミドルウェアも簡単につくれる。ミドルウェアは既存のHttpServiceに組み込んで（合成して）使う。試しに<code>X-HTTP4S-MESSAGE</code>というヘッダーを付与するミドルウェアを作ってみる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#75715e">// src/main/scala/jp/dakatsuka/http4stest/MessageMiddleware.scala
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">package</span> jp.dakatsuka.http4stest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.Header
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.server.HttpService
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">MessageMiddleware</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">(</span>service<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HttpService</span><span style="color:#f92672">,</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HttpService</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">HttpService</span><span style="color:#f92672">.</span>lift <span style="color:#f92672">{</span> req <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    service<span style="color:#f92672">.</span>map <span style="color:#f92672">{</span> res <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>      res<span style="color:#f92672">.</span>putHeaders<span style="color:#f92672">(</span><span style="color:#a6e22e">Header</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;X-HTTP4S-MESSAGE&#34;</span><span style="color:#f92672">,</span> message<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}.</span>apply<span style="color:#f92672">(</span>req<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>組み込み方はこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">BlazeBuilder</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>bindHttp<span style="color:#f92672">(</span><span style="color:#ae81ff">8080</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>mountService<span style="color:#f92672">(</span><span style="color:#a6e22e">MessageMiddleware</span><span style="color:#f92672">(</span>service<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello!!!!!&#34;</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>run
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>awaitShutdown<span style="color:#f92672">()</span>
</span></span></code></pre></div><p>ちゃんとヘッダーに追加されていることが分かる。</p>
<pre tabindex="0"><code>$ curl --dump-header - http://localhost:8080
HTTP/1.1 200 OK
Content-Length: 14
Content-Type: text/plain; charset=UTF-8
X-HTTP4S-MESSAGE: Hello!!!!!
Date: Sat, 14 Nov 2015 13:30:32 GMT

Hello World!!
</code></pre><h2 id="http4s-dsl">http4s-dsl<a hidden class="anchor" aria-hidden="true" href="#http4s-dsl">#</a></h2>
<p>http4s-dslというパッケージを追加すればSinatraのようにDSLを使ってルーティングを定義できる。</p>
<p>build.sbtに依存関係を追加する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>libraryDependencies <span style="color:#f92672">++=</span> <span style="color:#a6e22e">Seq</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;org.http4s&#34;</span> <span style="color:#f92672">%%</span> <span style="color:#e6db74">&#34;http4s-server&#34;</span>       <span style="color:#f92672">%</span> <span style="color:#e6db74">&#34;0.10.1&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;org.http4s&#34;</span> <span style="color:#f92672">%%</span> <span style="color:#e6db74">&#34;http4s-dsl&#34;</span>          <span style="color:#f92672">%</span> <span style="color:#e6db74">&#34;0.10.1&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;org.http4s&#34;</span> <span style="color:#f92672">%%</span> <span style="color:#e6db74">&#34;http4s-blaze-server&#34;</span> <span style="color:#f92672">%</span> <span style="color:#e6db74">&#34;0.10.1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>DSLを使うと次のように直感的にルーティングできるようになる。ちょっとしたマイクロサービスを作りたいときにはこれで十分な気がする。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s._
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.dsl._
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.server.HttpService
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> jp.dakatsuka.http4stest.model.User
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> service <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">HttpService</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">GET</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">Root</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Ok</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Document Root&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">GET</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">Root</span> <span style="color:#f92672">/</span> <span style="color:#e6db74">&#34;users&#34;</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Ok</span><span style="color:#f92672">(</span><span style="color:#a6e22e">User</span><span style="color:#f92672">.</span>all<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">GET</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">Root</span> <span style="color:#f92672">/</span> <span style="color:#e6db74">&#34;users&#34;</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">LongVar</span><span style="color:#f92672">(</span>id<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">User</span><span style="color:#f92672">.</span>find<span style="color:#f92672">(</span>id<span style="color:#f92672">)</span> <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>user<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">(</span>user<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">NotFound</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">GET</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">Root</span> <span style="color:#f92672">/</span> <span style="color:#e6db74">&#34;users&#34;</span> <span style="color:#f92672">/</span> screen_name <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">User</span><span style="color:#f92672">.</span>findOneByScreenName<span style="color:#f92672">(</span>screen_name<span style="color:#f92672">)</span> <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>user<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">(</span>user<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">NotFound</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> req <span style="color:#66d9ef">@</span> <span style="color:#a6e22e">POST</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">Root</span> <span style="color:#f92672">/</span> <span style="color:#e6db74">&#34;users&#34;</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    req<span style="color:#f92672">.</span>decode<span style="color:#f92672">[</span><span style="color:#66d9ef">UrlForm</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span> data <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">UserParams</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">for</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        email <span style="color:#66d9ef">&lt;-</span> data<span style="color:#f92672">.</span>getFirst<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;email&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        screen_name <span style="color:#66d9ef">&lt;-</span> data<span style="color:#f92672">.</span>getFirst<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;screen_name&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span> <span style="color:#66d9ef">yield</span> <span style="color:#a6e22e">UserParams</span><span style="color:#f92672">(</span>email<span style="color:#f92672">,</span> screen_name<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">???</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="json-レスポンスを返したい">JSON レスポンスを返したい<a hidden class="anchor" aria-hidden="true" href="#json-レスポンスを返したい">#</a></h3>
<p>厳密にはcase classを<code>Ok</code>や<code>NotFound</code>に渡したらJSON文字列に変換してレスポンスを返して欲しい。になる。</p>
<p>http4sは <code>EntityEncoder[T]</code> を定義しておけばどんな型でもレスポンスとして返せるという仕組みがある（逆の<code>EntityDecoder</code>もある）JSONに関しては http4s-argonaut という公式パッケージが用意されているのでそれを利用するのが良いだろう。Argonautが嫌な人はJson4s用のパッケージも用意されているのでそちらを。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>libraryDependencies <span style="color:#f92672">++=</span> <span style="color:#a6e22e">Seq</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;org.http4s&#34;</span> <span style="color:#f92672">%%</span> <span style="color:#e6db74">&#34;http4s-server&#34;</span>       <span style="color:#f92672">%</span> <span style="color:#e6db74">&#34;0.10.1&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;org.http4s&#34;</span> <span style="color:#f92672">%%</span> <span style="color:#e6db74">&#34;http4s-dsl&#34;</span>          <span style="color:#f92672">%</span> <span style="color:#e6db74">&#34;0.10.1&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;org.http4s&#34;</span> <span style="color:#f92672">%%</span> <span style="color:#e6db74">&#34;http4s-blaze-server&#34;</span> <span style="color:#f92672">%</span> <span style="color:#e6db74">&#34;0.10.1&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;org.http4s&#34;</span> <span style="color:#f92672">%%</span> <span style="color:#e6db74">&#34;http4s-argonaut&#34;</span>     <span style="color:#f92672">%</span> <span style="color:#e6db74">&#34;0.10.1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#75715e">// src/main/scala/jp/dakatsuka/http4stest/model/User.scala
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">package</span> jp.dakatsuka.http4s.model
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> argonaut.Argonaut._
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> argonaut.CodecJson
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.argonaut._
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.EntityEncoder
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">(</span>id<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Long</span><span style="color:#f92672">,</span> email<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> screen_name<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">User</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> userCodec<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">CodecJson</span><span style="color:#f92672">[</span><span style="color:#66d9ef">User</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> casecodec3<span style="color:#f92672">(</span><span style="color:#a6e22e">User</span><span style="color:#f92672">.</span>apply<span style="color:#f92672">,</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">.</span>unapply<span style="color:#f92672">)(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;email&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;screen_name&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> userEntityEncoder<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EntityEncoder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">User</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> jsonEncoderOf<span style="color:#f92672">[</span><span style="color:#66d9ef">User</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> usersEntityEncoder<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EntityEncoder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">User</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> jsonEncoderOf<span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">User</span><span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> all<span style="color:#f92672">()</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">User</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> find<span style="color:#f92672">(</span>id<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Long</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">User</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> findOneByScreenName<span style="color:#f92672">(</span>screen_name<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">User</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="まとめ">まとめ<a hidden class="anchor" aria-hidden="true" href="#まとめ">#</a></h2>
<p>駆け足でhttp4sを紹介してみたけど、個人的にはかなり使い勝手が良いと思う。Akka, Playframeworkのような重厚感もないし http4s-dsl を使えば簡単にAPIの実装も出来るだろう。お手軽感って大事だと思う。ルーティングやレスポンスを型安全に書けるのもポイントが高い。</p>
<p>懸念点としては最初にも書いたようにライバルが多くて消えてしまうのでは…ってところ。http4sはServletでも動くので頑張って欲しい。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.dakatsuka.jp/tags/scala.html">Scala</a></li>
      <li><a href="https://blog.dakatsuka.jp/tags/http4s.html">http4s</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://blog.dakatsuka.jp/">dakatsuka&#39;s blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
